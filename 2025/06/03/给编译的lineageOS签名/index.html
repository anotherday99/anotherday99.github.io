<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>给编译的lineageOS进行签名 | 又一天过去了</title><meta name="author" content="anotherday99"><meta name="copyright" content="anotherday99"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="本系列所有文章 搭建lineageOS编译环境给编译的lineageOS进行签名  你可以通过使用右下角的小齿轮，来开启黑夜模式和阅读模式。  如果你发现文章内容有错漏、你对文章内容有任何改进意见或者你阅读文章遇到了困难，都可以通过博客首页的邮箱联系我。    在使用文档前，我希望你有点基础，能够判断出哪些是完整的执行命令。部分指令有注解，请耐心将一整段的指令内容看完后再执行。强烈建议你完整过一遍">
<meta property="og:type" content="article">
<meta property="og:title" content="给编译的lineageOS进行签名">
<meta property="og:url" content="https://anotherday99.github.io/2025/06/03/%E7%BB%99%E7%BC%96%E8%AF%91%E7%9A%84lineageOS%E7%AD%BE%E5%90%8D/index.html">
<meta property="og:site_name" content="又一天过去了">
<meta property="og:description" content="本系列所有文章 搭建lineageOS编译环境给编译的lineageOS进行签名  你可以通过使用右下角的小齿轮，来开启黑夜模式和阅读模式。  如果你发现文章内容有错漏、你对文章内容有任何改进意见或者你阅读文章遇到了困难，都可以通过博客首页的邮箱联系我。    在使用文档前，我希望你有点基础，能够判断出哪些是完整的执行命令。部分指令有注解，请耐心将一整段的指令内容看完后再执行。强烈建议你完整过一遍">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.helloimg.com/i/2024/09/20/66ed953d4e2d6.jpg">
<meta property="article:published_time" content="2025-06-03T03:19:07.000Z">
<meta property="article:modified_time" content="2025-06-03T05:05:15.271Z">
<meta property="article:author" content="anotherday99">
<meta property="article:tag" content="lineageOS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.helloimg.com/i/2024/09/20/66ed953d4e2d6.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "给编译的lineageOS进行签名",
  "url": "https://anotherday99.github.io/2025/06/03/%E7%BB%99%E7%BC%96%E8%AF%91%E7%9A%84lineageOS%E7%AD%BE%E5%90%8D/",
  "image": "https://www.helloimg.com/i/2024/09/20/66ed953d4e2d6.jpg",
  "datePublished": "2025-06-03T03:19:07.000Z",
  "dateModified": "2025-06-03T05:05:15.271Z",
  "author": [
    {
      "@type": "Person",
      "name": "anotherday99",
      "url": "https://anotherday99.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://anotherday99.github.io/2025/06/03/%E7%BB%99%E7%BC%96%E8%AF%91%E7%9A%84lineageOS%E7%AD%BE%E5%90%8D/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":true,"top_n_per_article":1,"unescape":true,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: anotherday99","link":"链接: ","source":"来源: 又一天过去了","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '给编译的lineageOS进行签名',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/transpancy.css"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="又一天过去了" type="application/atom+xml">
</head><body><div id="web_bg" style="background-image: url(https://www.helloimg.com/i/2024/09/20/66ed953bf0c6e.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://www.helloimg.com/i/2024/09/20/66ed953d4e2d6.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background: transparent;"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">又一天过去了</span></a><a class="nav-page-title" href="/"><span class="site-name">给编译的lineageOS进行签名</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">给编译的lineageOS进行签名</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-06-03T03:19:07.000Z" title="发表于 2025-06-03 11:19:07">2025-06-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-06-03T05:05:15.271Z" title="更新于 2025-06-03 13:05:15">2025-06-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/lineageOS%E7%BC%96%E8%AF%91/">lineageOS编译</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">3.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>20分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:30,&quot;messagePrev&quot;:&quot;本文距离上次的更新已经有&quot;,&quot;messageNext&quot;:&quot;天，文章的部分内容可能已经过时，请小心使用.如遇到问题，可以通过邮箱联系我。&quot;,&quot;postUpdate&quot;:&quot;2025-06-03 13:05:15&quot;}" hidden></div><p><strong>本系列所有文章</strong></p>
<ol class="series-items"><li><a href="/2025/05/16/%E6%90%AD%E5%BB%BAlineageos%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83/" title="搭建lineageOS编译环境">搭建lineageOS编译环境</a></li><li><a href="/2025/06/03/%E7%BB%99%E7%BC%96%E8%AF%91%E7%9A%84lineageOS%E7%AD%BE%E5%90%8D/" title="给编译的lineageOS进行签名">给编译的lineageOS进行签名</a></li></ol>

<table><tr><td bgcolor=MistyRose>你可以通过使用右下角的小齿轮，来开启黑夜模式和阅读模式。

<p><strong>如果你发现文章内容有错漏、你对文章内容有任何改进意见或者你阅读文章遇到了困难，都可以通过博客首页的邮箱联系我。</strong></p>
</td></tr></table>

<hr>
<p><em><strong>在使用文档前，我希望你有点基础，能够判断出哪些是完整的执行命令。<br>部分指令有注解，请耐心将一整段的指令内容看完后再执行。<br>强烈建议你完整过一遍文档再进行签名操作！！！</strong></em></p>
<h1 id="对编译的文件进行签名"><a href="#对编译的文件进行签名" class="headerlink" title="对编译的文件进行签名"></a>对编译的文件进行签名</h1><p>使用终端进入到下载Android源代码的根目录，运行以下命令，<strong>请按需自行修改subject</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">subject=&#x27;/C=US/ST=California/L=Mountain View/O=Android/OU=Android/CN=Android/emailAddress=android@android.com&#x27;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkdir ~/.android-certs</span><br><span class="line">for cert in bluetooth cyngn-app media networkstack nfc platform releasekey sdk_sandbox shared testcert testkey verity; do \</span><br><span class="line">    ./development/tools/make_key ~/.android-certs/$cert &quot;$subject&quot;; \</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h2 id="示例：生成并将test-keys替换成你生成的正式密钥"><a href="#示例：生成并将test-keys替换成你生成的正式密钥" class="headerlink" title="示例：生成并将test-keys替换成你生成的正式密钥"></a>示例：生成并将test-keys替换成你生成的正式密钥</h2><p><strong>自定义主题（替换组织信息）</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">subject=&#x27;/C=CN/ST=Beijing/L=Beijing/O=MyCompany/OU=Android/CN=Android/emailAddress=dev@mycompany.com&#x27;</span><br></pre></td></tr></table></figure>
<p><strong>生成密钥</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkdir ~/.android-certs</span><br><span class="line">for cert in bluetooth cyngn-app media networkstack nfc platform releasekey sdk_sandbox shared testcert testkey verity; do \</span><br><span class="line">    ./development/tools/make_key ~/.android-certs/$cert &quot;$subject&quot;; \</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h1 id="编译时使用自定义密钥"><a href="#编译时使用自定义密钥" class="headerlink" title="编译时使用自定义密钥"></a>编译时使用自定义密钥</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">export DEFAULT_SYSTEM_DEV_CERTIFICATE=~/.android-certs/releasekey</span><br><span class="line">source build/envsetup.sh</span><br><span class="line">lunch lineage_kebab-userdebug</span><br><span class="line">brunch kebab​</span><br></pre></td></tr></table></figure>
<p><strong>注解：<br>这是在定义一个 ​​X.509 证书的主题（Subject）​​，用于所有生成的密钥。<br>C&#x3D;US：国家代码（美国）。<br>ST&#x3D;California：州&#x2F;省（加利福尼亚）。<br>L&#x3D;Mountain View：地区（山景城）。<br>O&#x3D;Android：组织名称（Android）。<br>OU&#x3D;Android：组织单位（Android）。<br>CN&#x3D;Android：通用名称（证书持有者名称）。<br>emailAddress&#x3D;<a href="mailto:&#x61;&#x6e;&#x64;&#x72;&#x6f;&#x69;&#x64;&#64;&#x61;&#x6e;&#x64;&#x72;&#x6f;&#x69;&#100;&#46;&#x63;&#111;&#109;">android@android.com</a>：联系邮箱。</strong></p>
<p><strong>LineageOS 19.1 及更高版本要求对 APEX 进行重新签名。 每个 APEX 文件都使用两个密钥进行签名：一个用于 APEX 中的微型文件系统映像，另一个用于整个 APEX。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cp ./development/tools/make_key ~/.android-certs/</span><br><span class="line">sed -i &#x27;s|2048|4096|g&#x27; ~/.android-certs/make_key</span><br></pre></td></tr></table></figure>
<p><strong>然后生成 APEX 密钥，更改下面的行以反映您的信息。【注意下列命令中也有subject，请按需自行修改】</strong><br><em><strong>生成没有密码的密钥，您需要为生成的每个 APEX 密钥输入两次空白密码</strong></em></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">for apex in com.android.adbd com.android.adservices com.android.adservices.api com.android.appsearch com.android.appsearch.apk com.android.art com.android.bluetooth com.android.btservices com.android.cellbroadcast com.android.compos com.android.configinfrastructure com.android.connectivity.resources com.android.conscrypt com.android.devicelock com.android.extservices com.android.graphics.pdf com.android.hardware.authsecret com.android.hardware.biometrics.face.virtual com.android.hardware.biometrics.fingerprint.virtual com.android.hardware.boot com.android.hardware.cas com.android.hardware.neuralnetworks com.android.hardware.rebootescrow com.android.hardware.wifi com.android.healthfitness com.android.hotspot2.osulogin com.android.i18n com.android.ipsec com.android.media com.android.media.swcodec com.android.mediaprovider com.android.nearby.halfsheet com.android.networkstack.tethering com.android.neuralnetworks com.android.nfcservices com.android.ondevicepersonalization com.android.os.statsd com.android.permission com.android.profiling com.android.resolv com.android.rkpd com.android.runtime com.android.safetycenter.resources com.android.scheduling com.android.sdkext com.android.support.apexer com.android.telephony com.android.telephonymodules com.android.tethering com.android.tzdata com.android.uwb com.android.uwb.resources com.android.virt com.android.vndk.current com.android.vndk.current.on_vendor com.android.wifi com.android.wifi.dialog com.android.wifi.resources com.google.pixel.camera.hal com.google.pixel.vibrator.hal com.qorvo.uwb; do \</span><br><span class="line">    subject=&#x27;/C=US/ST=California/L=Mountain View/O=Android/OU=Android/CN=&#x27;$apex&#x27;/emailAddress=android@android.com&#x27;; \</span><br><span class="line">    ~/.android-certs/make_key ~/.android-certs/$apex &quot;$subject&quot;; \</span><br><span class="line">    openssl pkcs8 -in ~/.android-certs/$apex.pk8 -inform DER -nocrypt -out ~/.android-certs/$apex.pem; \</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p><em><strong>生成使用密码的密钥，您需要为生成的每个 APEX 密钥输入两次密码。</strong></em></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">for apex in com.android.adbd com.android.adservices com.android.adservices.api com.android.appsearch com.android.appsearch.apk com.android.art com.android.bluetooth com.android.btservices com.android.cellbroadcast com.android.compos com.android.configinfrastructure com.android.connectivity.resources com.android.conscrypt com.android.devicelock com.android.extservices com.android.graphics.pdf com.android.hardware.authsecret com.android.hardware.biometrics.face.virtual com.android.hardware.biometrics.fingerprint.virtual com.android.hardware.boot com.android.hardware.cas com.android.hardware.neuralnetworks com.android.hardware.rebootescrow com.android.hardware.wifi com.android.healthfitness com.android.hotspot2.osulogin com.android.i18n com.android.ipsec com.android.media com.android.media.swcodec com.android.mediaprovider com.android.nearby.halfsheet com.android.networkstack.tethering com.android.neuralnetworks com.android.nfcservices com.android.ondevicepersonalization com.android.os.statsd com.android.permission com.android.profiling com.android.resolv com.android.rkpd com.android.runtime com.android.safetycenter.resources com.android.scheduling com.android.sdkext com.android.support.apexer com.android.telephony com.android.telephonymodules com.android.tethering com.android.tzdata com.android.uwb com.android.uwb.resources com.android.virt com.android.vndk.current com.android.vndk.current.on_vendor com.android.wifi com.android.wifi.dialog com.android.wifi.resources com.google.pixel.camera.hal com.google.pixel.vibrator.hal com.qorvo.uwb; do \</span><br><span class="line">    subject=&#x27;/C=US/ST=California/L=Mountain View/O=Android/OU=Android/CN=&#x27;$apex&#x27;/emailAddress=android@android.com&#x27;; \</span><br><span class="line">    ~/.android-certs/make_key ~/.android-certs/$apex &quot;$subject&quot;; \</span><br><span class="line">    openssl pkcs8 -in ~/.android-certs/$apex.pk8 -inform DER -out ~/.android-certs/$apex.pem; \</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h2 id="生成安装包"><a href="#生成安装包" class="headerlink" title="生成安装包"></a>生成安装包</h2><p>生成目标文件并对其进行签名，按照设备的构建说明操作后，不要运行构建命令 ，而是改成以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">breakfast &lt;codename&gt;</span><br><span class="line">mka target-files-package otatools</span><br></pre></td></tr></table></figure>
<p>请坐下来等待一段时间。这可能需要一段时间，具体取决于您计算机的规格。当它完成了，你只需要签署所有 APK 和 APEX。</p>
<h2 id="LineageOS-版本-18-1-及更低版本的签名过程："><a href="#LineageOS-版本-18-1-及更低版本的签名过程：" class="headerlink" title="LineageOS 版本 18.1 及更低版本的签名过程："></a>LineageOS 版本 18.1 及更低版本的签名过程：</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">croot</span><br><span class="line">sign_target_files_apks -o -d ~/.android-certs \</span><br><span class="line">    $OUT/obj/PACKAGING/target_files_intermediates/*-target_files-*.zip \</span><br><span class="line">    signed-target_files.zip</span><br></pre></td></tr></table></figure>
<h2 id="LineageOS-版本-19-1-及更高版本的签名过程："><a href="#LineageOS-版本-19-1-及更高版本的签名过程：" class="headerlink" title="LineageOS 版本 19.1 及更高版本的签名过程："></a>LineageOS 版本 19.1 及更高版本的签名过程：</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">croot</span><br><span class="line">sign_target_files_apks -o -d ~/.android-certs \</span><br><span class="line">    --extra_apks AdServicesApk.apk=$HOME/.android-certs/releasekey \</span><br><span class="line">    --extra_apks FederatedCompute.apk=$HOME/.android-certs/releasekey \</span><br><span class="line">    --extra_apks HalfSheetUX.apk=$HOME/.android-certs/releasekey \</span><br><span class="line">    --extra_apks HealthConnectBackupRestore.apk=$HOME/.android-certs/releasekey \</span><br><span class="line">    --extra_apks HealthConnectController.apk=$HOME/.android-certs/releasekey \</span><br><span class="line">    --extra_apks OsuLogin.apk=$HOME/.android-certs/releasekey \</span><br><span class="line">    --extra_apks SafetyCenterResources.apk=$HOME/.android-certs/releasekey \</span><br><span class="line">    --extra_apks ServiceConnectivityResources.apk=$HOME/.android-certs/releasekey \</span><br><span class="line">    --extra_apks ServiceUwbResources.apk=$HOME/.android-certs/releasekey \</span><br><span class="line">    --extra_apks ServiceWifiResources.apk=$HOME/.android-certs/releasekey \</span><br><span class="line">    --extra_apks WifiDialog.apk=$HOME/.android-certs/releasekey \</span><br><span class="line">    --extra_apks com.android.adbd.apex=$HOME/.android-certs/com.android.adbd \</span><br><span class="line">    --extra_apks com.android.adservices.apex=$HOME/.android-certs/com.android.adservices \</span><br><span class="line">    --extra_apks com.android.adservices.api.apex=$HOME/.android-certs/com.android.adservices.api \</span><br><span class="line">    --extra_apks com.android.appsearch.apex=$HOME/.android-certs/com.android.appsearch \</span><br><span class="line">    --extra_apks com.android.appsearch.apk.apex=$HOME/.android-certs/com.android.appsearch.apk \</span><br><span class="line">    --extra_apks com.android.art.apex=$HOME/.android-certs/com.android.art \</span><br><span class="line">    --extra_apks com.android.bluetooth.apex=$HOME/.android-certs/com.android.bluetooth \</span><br><span class="line">    --extra_apks com.android.btservices.apex=$HOME/.android-certs/com.android.btservices \</span><br><span class="line">    --extra_apks com.android.cellbroadcast.apex=$HOME/.android-certs/com.android.cellbroadcast \</span><br><span class="line">    --extra_apks com.android.compos.apex=$HOME/.android-certs/com.android.compos \</span><br><span class="line">    --extra_apks com.android.configinfrastructure.apex=$HOME/.android-certs/com.android.configinfrastructure \</span><br><span class="line">    --extra_apks com.android.connectivity.resources.apex=$HOME/.android-certs/com.android.connectivity.resources \</span><br><span class="line">    --extra_apks com.android.conscrypt.apex=$HOME/.android-certs/com.android.conscrypt \</span><br><span class="line">    --extra_apks com.android.devicelock.apex=$HOME/.android-certs/com.android.devicelock \</span><br><span class="line">    --extra_apks com.android.extservices.apex=$HOME/.android-certs/com.android.extservices \</span><br><span class="line">    --extra_apks com.android.graphics.pdf.apex=$HOME/.android-certs/com.android.graphics.pdf \</span><br><span class="line">    --extra_apks com.android.hardware.authsecret.apex=$HOME/.android-certs/com.android.hardware.authsecret \</span><br><span class="line">    --extra_apks com.android.hardware.biometrics.face.virtual.apex=$HOME/.android-certs/com.android.hardware.biometrics.face.virtual \</span><br><span class="line">    --extra_apks com.android.hardware.biometrics.fingerprint.virtual.apex=$HOME/.android-certs/com.android.hardware.biometrics.fingerprint.virtual \</span><br><span class="line">    --extra_apks com.android.hardware.boot.apex=$HOME/.android-certs/com.android.hardware.boot \</span><br><span class="line">    --extra_apks com.android.hardware.cas.apex=$HOME/.android-certs/com.android.hardware.cas \</span><br><span class="line">    --extra_apks com.android.hardware.neuralnetworks.apex=$HOME/.android-certs/com.android.hardware.neuralnetworks \</span><br><span class="line">    --extra_apks com.android.hardware.rebootescrow.apex=$HOME/.android-certs/com.android.hardware.rebootescrow \</span><br><span class="line">    --extra_apks com.android.hardware.wifi.apex=$HOME/.android-certs/com.android.hardware.wifi \</span><br><span class="line">    --extra_apks com.android.healthfitness.apex=$HOME/.android-certs/com.android.healthfitness \</span><br><span class="line">    --extra_apks com.android.hotspot2.osulogin.apex=$HOME/.android-certs/com.android.hotspot2.osulogin \</span><br><span class="line">    --extra_apks com.android.i18n.apex=$HOME/.android-certs/com.android.i18n \</span><br><span class="line">    --extra_apks com.android.ipsec.apex=$HOME/.android-certs/com.android.ipsec \</span><br><span class="line">    --extra_apks com.android.media.apex=$HOME/.android-certs/com.android.media \</span><br><span class="line">    --extra_apks com.android.media.swcodec.apex=$HOME/.android-certs/com.android.media.swcodec \</span><br><span class="line">    --extra_apks com.android.mediaprovider.apex=$HOME/.android-certs/com.android.mediaprovider \</span><br><span class="line">    --extra_apks com.android.nearby.halfsheet.apex=$HOME/.android-certs/com.android.nearby.halfsheet \</span><br><span class="line">    --extra_apks com.android.networkstack.tethering.apex=$HOME/.android-certs/com.android.networkstack.tethering \</span><br><span class="line">    --extra_apks com.android.neuralnetworks.apex=$HOME/.android-certs/com.android.neuralnetworks \</span><br><span class="line">    --extra_apks com.android.nfcservices.apex=$HOME/.android-certs/com.android.nfcservices \</span><br><span class="line">    --extra_apks com.android.ondevicepersonalization.apex=$HOME/.android-certs/com.android.ondevicepersonalization \</span><br><span class="line">    --extra_apks com.android.os.statsd.apex=$HOME/.android-certs/com.android.os.statsd \</span><br><span class="line">    --extra_apks com.android.permission.apex=$HOME/.android-certs/com.android.permission \</span><br><span class="line">    --extra_apks com.android.profiling.apex=$HOME/.android-certs/com.android.profiling \</span><br><span class="line">    --extra_apks com.android.resolv.apex=$HOME/.android-certs/com.android.resolv \</span><br><span class="line">    --extra_apks com.android.rkpd.apex=$HOME/.android-certs/com.android.rkpd \</span><br><span class="line">    --extra_apks com.android.runtime.apex=$HOME/.android-certs/com.android.runtime \</span><br><span class="line">    --extra_apks com.android.safetycenter.resources.apex=$HOME/.android-certs/com.android.safetycenter.resources \</span><br><span class="line">    --extra_apks com.android.scheduling.apex=$HOME/.android-certs/com.android.scheduling \</span><br><span class="line">    --extra_apks com.android.sdkext.apex=$HOME/.android-certs/com.android.sdkext \</span><br><span class="line">    --extra_apks com.android.support.apexer.apex=$HOME/.android-certs/com.android.support.apexer \</span><br><span class="line">    --extra_apks com.android.telephony.apex=$HOME/.android-certs/com.android.telephony \</span><br><span class="line">    --extra_apks com.android.telephonymodules.apex=$HOME/.android-certs/com.android.telephonymodules \</span><br><span class="line">    --extra_apks com.android.tethering.apex=$HOME/.android-certs/com.android.tethering \</span><br><span class="line">    --extra_apks com.android.tzdata.apex=$HOME/.android-certs/com.android.tzdata \</span><br><span class="line">    --extra_apks com.android.uwb.apex=$HOME/.android-certs/com.android.uwb \</span><br><span class="line">    --extra_apks com.android.uwb.resources.apex=$HOME/.android-certs/com.android.uwb.resources \</span><br><span class="line">    --extra_apks com.android.virt.apex=$HOME/.android-certs/com.android.virt \</span><br><span class="line">    --extra_apks com.android.vndk.current.apex=$HOME/.android-certs/com.android.vndk.current \</span><br><span class="line">    --extra_apks com.android.vndk.current.on_vendor.apex=$HOME/.android-certs/com.android.vndk.current.on_vendor \</span><br><span class="line">    --extra_apks com.android.wifi.apex=$HOME/.android-certs/com.android.wifi \</span><br><span class="line">    --extra_apks com.android.wifi.dialog.apex=$HOME/.android-certs/com.android.wifi.dialog \</span><br><span class="line">    --extra_apks com.android.wifi.resources.apex=$HOME/.android-certs/com.android.wifi.resources \</span><br><span class="line">    --extra_apks com.google.pixel.camera.hal.apex=$HOME/.android-certs/com.google.pixel.camera.hal \</span><br><span class="line">    --extra_apks com.google.pixel.vibrator.hal.apex=$HOME/.android-certs/com.google.pixel.vibrator.hal \</span><br><span class="line">    --extra_apks com.qorvo.uwb.apex=$HOME/.android-certs/com.qorvo.uwb \</span><br><span class="line">    --extra_apex_payload_key com.android.adbd.apex=$HOME/.android-certs/com.android.adbd.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.adservices.apex=$HOME/.android-certs/com.android.adservices.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.adservices.api.apex=$HOME/.android-certs/com.android.adservices.api.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.appsearch.apex=$HOME/.android-certs/com.android.appsearch.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.appsearch.apk.apex=$HOME/.android-certs/com.android.appsearch.apk.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.art.apex=$HOME/.android-certs/com.android.art.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.bluetooth.apex=$HOME/.android-certs/com.android.bluetooth.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.btservices.apex=$HOME/.android-certs/com.android.btservices.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.cellbroadcast.apex=$HOME/.android-certs/com.android.cellbroadcast.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.compos.apex=$HOME/.android-certs/com.android.compos.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.configinfrastructure.apex=$HOME/.android-certs/com.android.configinfrastructure.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.connectivity.resources.apex=$HOME/.android-certs/com.android.connectivity.resources.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.conscrypt.apex=$HOME/.android-certs/com.android.conscrypt.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.devicelock.apex=$HOME/.android-certs/com.android.devicelock.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.extservices.apex=$HOME/.android-certs/com.android.extservices.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.graphics.pdf.apex=$HOME/.android-certs/com.android.graphics.pdf.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.hardware.authsecret.apex=$HOME/.android-certs/com.android.hardware.authsecret.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.hardware.biometrics.face.virtual.apex=$HOME/.android-certs/com.android.hardware.biometrics.face.virtual.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.hardware.biometrics.fingerprint.virtual.apex=$HOME/.android-certs/com.android.hardware.biometrics.fingerprint.virtual.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.hardware.boot.apex=$HOME/.android-certs/com.android.hardware.boot.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.hardware.cas.apex=$HOME/.android-certs/com.android.hardware.cas.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.hardware.neuralnetworks.apex=$HOME/.android-certs/com.android.hardware.neuralnetworks.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.hardware.rebootescrow.apex=$HOME/.android-certs/com.android.hardware.rebootescrow.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.hardware.wifi.apex=$HOME/.android-certs/com.android.hardware.wifi.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.healthfitness.apex=$HOME/.android-certs/com.android.healthfitness.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.hotspot2.osulogin.apex=$HOME/.android-certs/com.android.hotspot2.osulogin.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.i18n.apex=$HOME/.android-certs/com.android.i18n.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.ipsec.apex=$HOME/.android-certs/com.android.ipsec.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.media.apex=$HOME/.android-certs/com.android.media.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.media.swcodec.apex=$HOME/.android-certs/com.android.media.swcodec.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.mediaprovider.apex=$HOME/.android-certs/com.android.mediaprovider.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.nearby.halfsheet.apex=$HOME/.android-certs/com.android.nearby.halfsheet.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.networkstack.tethering.apex=$HOME/.android-certs/com.android.networkstack.tethering.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.neuralnetworks.apex=$HOME/.android-certs/com.android.neuralnetworks.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.nfcservices.apex=$HOME/.android-certs/com.android.nfcservices.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.ondevicepersonalization.apex=$HOME/.android-certs/com.android.ondevicepersonalization.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.os.statsd.apex=$HOME/.android-certs/com.android.os.statsd.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.permission.apex=$HOME/.android-certs/com.android.permission.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.profiling.apex=$HOME/.android-certs/com.android.profiling.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.resolv.apex=$HOME/.android-certs/com.android.resolv.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.rkpd.apex=$HOME/.android-certs/com.android.rkpd.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.runtime.apex=$HOME/.android-certs/com.android.runtime.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.safetycenter.resources.apex=$HOME/.android-certs/com.android.safetycenter.resources.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.scheduling.apex=$HOME/.android-certs/com.android.scheduling.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.sdkext.apex=$HOME/.android-certs/com.android.sdkext.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.support.apexer.apex=$HOME/.android-certs/com.android.support.apexer.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.telephony.apex=$HOME/.android-certs/com.android.telephony.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.telephonymodules.apex=$HOME/.android-certs/com.android.telephonymodules.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.tethering.apex=$HOME/.android-certs/com.android.tethering.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.tzdata.apex=$HOME/.android-certs/com.android.tzdata.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.uwb.apex=$HOME/.android-certs/com.android.uwb.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.uwb.resources.apex=$HOME/.android-certs/com.android.uwb.resources.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.virt.apex=$HOME/.android-certs/com.android.virt.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.vndk.current.apex=$HOME/.android-certs/com.android.vndk.current.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.vndk.current.on_vendor.apex=$HOME/.android-certs/com.android.vndk.current.on_vendor.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.wifi.apex=$HOME/.android-certs/com.android.wifi.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.wifi.dialog.apex=$HOME/.android-certs/com.android.wifi.dialog.pem \</span><br><span class="line">    --extra_apex_payload_key com.android.wifi.resources.apex=$HOME/.android-certs/com.android.wifi.resources.pem \</span><br><span class="line">    --extra_apex_payload_key com.google.pixel.camera.hal.apex=$HOME/.android-certs/com.google.pixel.camera.hal.pem \</span><br><span class="line">    --extra_apex_payload_key com.google.pixel.vibrator.hal.apex=$HOME/.android-certs/com.google.pixel.vibrator.hal.pem \</span><br><span class="line">    --extra_apex_payload_key com.qorvo.uwb.apex=$HOME/.android-certs/com.qorvo.uwb.pem \</span><br><span class="line">    $OUT/obj/PACKAGING/target_files_intermediates/*-target_files*.zip \</span><br><span class="line">    signed-target_files.zip</span><br></pre></td></tr></table></figure>
<h2 id="生成安装包。现在，要生成可安装的-zip，请运行："><a href="#生成安装包。现在，要生成可安装的-zip，请运行：" class="headerlink" title="生成安装包。现在，要生成可安装的 zip，请运行："></a>生成安装包。现在，要生成可安装的 zip，请运行：</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ota_from_target_files -k ~/.android-certs/releasekey \</span><br><span class="line">    --block --backup=true \</span><br><span class="line">    signed-target_files.zip \</span><br><span class="line">    signed-ota_update.zip</span><br></pre></td></tr></table></figure>
<p>然后，像往常一样在 recovery 中安装 zip。</p>
<hr>
<h1 id="指令注解："><a href="#指令注解：" class="headerlink" title="指令注解："></a>指令注解：</h1><p><strong>mka target-files-package otatools</strong>是用于 Android 系统编译的命令，其作用可分为两部分：</p>
<h2 id="target-files-package"><a href="#target-files-package" class="headerlink" title="target-files-package"></a>target-files-package</h2><p>​​功能​​：生成一个名为 ​​target-files.zip​​ 的中间文件包，包含构建完整 OTA 更新包所需的全部内容：</p>
<ul>
<li>系统镜像：system.img、vendor.img、boot.img 等。</li>
<li>设备文件：内核、设备树（dtbo）、专有二进制文件（Blobs）。</li>
<li>元数据：构建指纹（Build Fingerprint）、文件系统结构（META&#x2F; 目录）。</li>
</ul>
<h3 id="用途："><a href="#用途：" class="headerlink" title="用途："></a>用途：</h3><ul>
<li>生成OTA增量包（如 incremental_ota_update.zip）。</li>
<li>签名系统镜像（例如用于发布官方固件）。</li>
</ul>
<h2 id="otatools"><a href="#otatools" class="headerlink" title="otatools"></a>otatools</h2><p>​​功能​​：编译与 OTA 相关的工具链，包括：<br>​​- ota_from_target_files​​：将 target-files.zip 转换为最终 OTA 包的脚本。<br>​​- sign_target_files_apks​​：签名系统镜像的工具。<br>​​- img2simg&#x2F;simg2img​​：处理稀疏镜像（Sparse Image）的工具。<br>​​路径​​：编译后的工具默认存放在 out&#x2F;host&#x2F;linux-x86&#x2F;bin&#x2F;（Linux 环境下）。</p>
<h2 id="完整命令的作用"><a href="#完整命令的作用" class="headerlink" title="完整命令的作用"></a>完整命令的作用</h2><p>同时执行以下两个任务：</p>
<ul>
<li>生成 target-files.zip（位于 out&#x2F;target&#x2F;product&#x2F;<device>&#x2F;obj&#x2F;PACKAGING&#x2F;target_files_intermediates&#x2F;）。</li>
<li>编译 OTA 工具链（生成 otatools 相关二进制文件）。</li>
</ul>
<h2 id="典型使用场景"><a href="#典型使用场景" class="headerlink" title="典型使用场景"></a>典型使用场景</h2><h3 id="生成完整-OTA包"><a href="#生成完整-OTA包" class="headerlink" title="生成完整 OTA包"></a>生成完整 OTA包</h3><ol>
<li>生成 target-files.zip</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mka target-files-package</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>生成完整 OTA 包（-k 指定签名密钥）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./out/host/linux-x86/bin/ota_from_target_files -k ./keys/releasekey \</span><br><span class="line">  out/target/product/kebab/obj/PACKAGING/target_files_intermediates/*.zip \</span><br><span class="line">  lineage-21.0-unsigned-kebab-ota.zip</span><br></pre></td></tr></table></figure>

<h3 id="生成增量-OTA-包"><a href="#生成增量-OTA-包" class="headerlink" title="生成增量 OTA 包"></a>生成增量 OTA 包</h3><ol>
<li>生成旧版本 target-files.zip（例如旧系统版本）<br><strong>切换到旧版本代码分支</strong></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git checkout old-release-branch</span><br></pre></td></tr></table></figure>
<p>清理旧构建产物（确保无残留）</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mka clean</span><br></pre></td></tr></table></figure>
<p>设置构建环境</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">source build/envsetup.sh</span><br><span class="line">lunch &lt;product_name&gt;-userdebug  --&gt;替换为具体设备名</span><br></pre></td></tr></table></figure>
<p>构建 target-files.zip</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mka target-files-package</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>生成新版本 target-files.zip（例如新系统版本）<br>切换到新版本代码分支</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git checkout new-release-branch</span><br></pre></td></tr></table></figure>
<p>清理构建环境（关键！避免旧版本干扰）</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mka installclean</span><br></pre></td></tr></table></figure>
<p>重新设置环境</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">source build/envsetup.sh</span><br><span class="line">lunch &lt;product_name&gt;-userdebug  #这里需要确保与旧版本同一设备名</span><br></pre></td></tr></table></figure>
<p>构建 target-files.zip</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mka target-files-package</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>生成增量包（需指定新旧两个 target-files.zip）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 1. 进入AOSP构建目录</span><br><span class="line">cd &lt;path-to-android-source&gt;</span><br><span class="line"># 2. 初始化构建环境</span><br><span class="line">source build/envsetup.sh</span><br><span class="line">lunch &lt;product_name&gt;-userdebug  --&gt; 选择相同的设备名</span><br><span class="line"># 3. 执行增量包生成（关键步骤）</span><br><span class="line">./out/host/linux-x86/bin/ota_from_target_files \</span><br><span class="line">  -k vendor/releasekeys/releasekey \    --&gt; 签名密钥（必须指定）</span><br><span class="line">  -i old-target_files.zip \             --&gt; 旧版本target-files</span><br><span class="line">  new-target_files.zip \                --&gt; 新版本target-files</span><br><span class="line">  incremental-ota_update.zip            --&gt; 输出的增量包名</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>验证生成的增量包</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">unzip -l incremental-ota_update.zip</span><br></pre></td></tr></table></figure>
<p>请确认包含以下关键文件：</p>
<ul>
<li>META-INF&#x2F;com&#x2F;google&#x2F;android&#x2F;update-binary</li>
<li>patch&#x2F;</li>
<li>system.new.dat</li>
</ul>
<ol start="5">
<li>注意事项​​<br>​​1.依赖关系​​：执行此命令前需确保已完成完整系统编译（例如已执行 brunch kebab）。<br>​​2.签名密钥​​：发布正式 OTA 包需使用私钥签名（-k 参数），测试时可跳过签名步骤。<br>​​3.路径适配​​：根据实际设备代号（如 kebab）和编译环境（如 linux-x86）调整路径。<br>⚠️ 注意：两个版本的 lunch 必须选择相同的 <product_name>-userdebug，否则会导致 OTA 包生成失败。<br><strong>注解：<br>linux-x86 表示你的主机是 ​​Linux 操作系统 + x86 架构的 CPU​​。<br>如果你在 macOS 上编译，目录会变成 darwin-x86 或 darwin-arm64（Apple Silicon）。<br>这一目录是 Android 编译系统自动生成的，无需手动干预。</strong></li>
</ol>
<hr>
<p>target-files.zip 结构示例​​：<br>├── BOOT&#x2F;<br>├── IMAGES&#x2F;          –&gt;系统镜像（system.img, vendor.img 等）<br>├── META&#x2F;            –&gt; 元数据（构建信息、文件列表）<br>├── OTA&#x2F;             –&gt; OTA 更新脚本<br>└── SYSTEM&#x2F;          –&gt; 系统文件（未打包成镜像的原始文件）</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://anotherday99.github.io">anotherday99</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://anotherday99.github.io/2025/06/03/%E7%BB%99%E7%BC%96%E8%AF%91%E7%9A%84lineageOS%E7%AD%BE%E5%90%8D/">https://anotherday99.github.io/2025/06/03/给编译的lineageOS签名/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://anotherday99.github.io" target="_blank">又一天过去了</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/lineageOS/">lineageOS</a></div><div class="post-share"><div class="social-share" data-image="https://www.helloimg.com/i/2024/09/20/66ed953d4e2d6.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/05/16/%E6%90%AD%E5%BB%BAlineageos%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83/" title="搭建lineageOS编译环境"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">搭建lineageOS编译环境</div></div><div class="info-2"><div class="info-item-1">本系列所有文章 搭建lineageOS编译环境给编译的lineageOS进行签名  你可以通过使用右下角的小齿轮，来开启黑夜模式和阅读模式。  如果你发现文章内容有错漏、你对文章内容有任何改进意见或者你阅读文章遇到了困难，都可以通过博客首页的邮箱联系我。    操作系统Debian12*需要root权限 【核心硬件建议：  CPU核心数：至少 8 核以上。性能优先级：多核性能 &gt; 单核性能（编译过程高度并行化）。 内存（RAM）最低要求：16GB（勉强可用，但可能因设备代码量不同而频繁卡顿），需要扩展swap，不然进程会被kill。推荐配置：32GB 或更高（避免因内存不足导致编译中断）。 存储（硬盘）容量：至少 500GB 可用空间（源码 + 编译产物可能占用 300GB 以上，内存不够得开swap、后续加速编译要开ccache，也得个大几十GB）。类型：NVMe SSD（编译过程涉及大量文件读写，SSD 速度直接影响效率）。 操作系统官方支持：Debian Stable（如 本文档使用的就是Debian12）或 Ubuntu LTS（如 22.04&#x2F;24.04...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/05/16/%E6%90%AD%E5%BB%BAlineageos%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83/" title="搭建lineageOS编译环境"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-16</div><div class="info-item-2">搭建lineageOS编译环境</div></div><div class="info-2"><div class="info-item-1">本系列所有文章 搭建lineageOS编译环境给编译的lineageOS进行签名  你可以通过使用右下角的小齿轮，来开启黑夜模式和阅读模式。  如果你发现文章内容有错漏、你对文章内容有任何改进意见或者你阅读文章遇到了困难，都可以通过博客首页的邮箱联系我。    操作系统Debian12*需要root权限 【核心硬件建议：  CPU核心数：至少 8 核以上。性能优先级：多核性能 &gt; 单核性能（编译过程高度并行化）。 内存（RAM）最低要求：16GB（勉强可用，但可能因设备代码量不同而频繁卡顿），需要扩展swap，不然进程会被kill。推荐配置：32GB 或更高（避免因内存不足导致编译中断）。 存储（硬盘）容量：至少 500GB 可用空间（源码 + 编译产物可能占用 300GB 以上，内存不够得开swap、后续加速编译要开ccache，也得个大几十GB）。类型：NVMe SSD（编译过程涉及大量文件读写，SSD 速度直接影响效率）。 操作系统官方支持：Debian Stable（如 本文档使用的就是Debian12）或 Ubuntu LTS（如 22.04&#x2F;24.04...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AF%B9%E7%BC%96%E8%AF%91%E7%9A%84%E6%96%87%E4%BB%B6%E8%BF%9B%E8%A1%8C%E7%AD%BE%E5%90%8D"><span class="toc-number">1.</span> <span class="toc-text">对编译的文件进行签名</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A%E7%94%9F%E6%88%90%E5%B9%B6%E5%B0%86test-keys%E6%9B%BF%E6%8D%A2%E6%88%90%E4%BD%A0%E7%94%9F%E6%88%90%E7%9A%84%E6%AD%A3%E5%BC%8F%E5%AF%86%E9%92%A5"><span class="toc-number">1.1.</span> <span class="toc-text">示例：生成并将test-keys替换成你生成的正式密钥</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E6%97%B6%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AF%86%E9%92%A5"><span class="toc-number">2.</span> <span class="toc-text">编译时使用自定义密钥</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%AE%89%E8%A3%85%E5%8C%85"><span class="toc-number">2.1.</span> <span class="toc-text">生成安装包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LineageOS-%E7%89%88%E6%9C%AC-18-1-%E5%8F%8A%E6%9B%B4%E4%BD%8E%E7%89%88%E6%9C%AC%E7%9A%84%E7%AD%BE%E5%90%8D%E8%BF%87%E7%A8%8B%EF%BC%9A"><span class="toc-number">2.2.</span> <span class="toc-text">LineageOS 版本 18.1 及更低版本的签名过程：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LineageOS-%E7%89%88%E6%9C%AC-19-1-%E5%8F%8A%E6%9B%B4%E9%AB%98%E7%89%88%E6%9C%AC%E7%9A%84%E7%AD%BE%E5%90%8D%E8%BF%87%E7%A8%8B%EF%BC%9A"><span class="toc-number">2.3.</span> <span class="toc-text">LineageOS 版本 19.1 及更高版本的签名过程：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%AE%89%E8%A3%85%E5%8C%85%E3%80%82%E7%8E%B0%E5%9C%A8%EF%BC%8C%E8%A6%81%E7%94%9F%E6%88%90%E5%8F%AF%E5%AE%89%E8%A3%85%E7%9A%84-zip%EF%BC%8C%E8%AF%B7%E8%BF%90%E8%A1%8C%EF%BC%9A"><span class="toc-number">2.4.</span> <span class="toc-text">生成安装包。现在，要生成可安装的 zip，请运行：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8C%87%E4%BB%A4%E6%B3%A8%E8%A7%A3%EF%BC%9A"><span class="toc-number">3.</span> <span class="toc-text">指令注解：</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#target-files-package"><span class="toc-number">3.1.</span> <span class="toc-text">target-files-package</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E9%80%94%EF%BC%9A"><span class="toc-number">3.1.1.</span> <span class="toc-text">用途：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#otatools"><span class="toc-number">3.2.</span> <span class="toc-text">otatools</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E5%91%BD%E4%BB%A4%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">3.3.</span> <span class="toc-text">完整命令的作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B8%E5%9E%8B%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">3.4.</span> <span class="toc-text">典型使用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%AE%8C%E6%95%B4-OTA%E5%8C%85"><span class="toc-number">3.4.1.</span> <span class="toc-text">生成完整 OTA包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%A2%9E%E9%87%8F-OTA-%E5%8C%85"><span class="toc-number">3.4.2.</span> <span class="toc-text">生成增量 OTA 包</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background: transparent;"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2024 - 2025 By anotherday99</span></div><div class="footer_custom_text">嘿，欢迎来到我的<a href="https://anotherday99.github.io/">博客</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"></div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>